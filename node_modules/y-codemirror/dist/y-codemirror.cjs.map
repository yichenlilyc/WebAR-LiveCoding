{"version":3,"file":"y-codemirror.cjs","sources":["../src/y-codemirror.js"],"sourcesContent":["/**\n * @module bindings/textarea\n */\n\nimport { createMutex } from 'lib0/mutex.js'\nimport * as math from 'lib0/math.js'\nimport * as Y from 'yjs'\nimport * as func from 'lib0/function.js'\nimport * as eventloop from 'lib0/eventloop.js'\nimport * as diff from 'lib0/diff.js'\nimport CodeMirror from 'codemirror'\n\nexport const cmOrigin = 'prosemirror-binding'\n\n/**\n * @param {CodemirrorBinding} binding\n * @param {any} event\n */\nconst typeObserver = (binding, event) => {\n  binding._mux(() => {\n    const cmDoc = binding.cmDoc\n    const cm = cmDoc.getEditor()\n    // Normally the position is right-associated\n    // But when remote changes happen, it looks like the remote user is hijacking your position.\n    // Just for remote insertions, we make the collapsed cursor left-associated.\n    // If selection is not collapsed, we only make \"to\" left associated\n    let anchor = cm.indexFromPos(cm.getCursor('anchor'))\n    let head = cm.indexFromPos(cm.getCursor('head'))\n    const switchSel = head < anchor\n    // normalize selection so that anchor < head, switch back later\n    if (switchSel) {\n      const tmp = head\n      head = anchor\n      anchor = tmp\n    }\n    const performChange = () => {\n      const delta = event.delta\n      let index = 0\n      for (let i = 0; i < event.delta.length; i++) {\n        const d = delta[i]\n        if (d.retain) {\n          index += d.retain\n        } else if (d.insert) {\n          if (index < anchor || (anchor < head && index === anchor)) {\n            anchor += d.insert.length\n          }\n          if (index < head) {\n            head += d.insert.length\n          }\n          const pos = cmDoc.posFromIndex(index)\n          cmDoc.replaceRange(d.insert, pos, pos, cmOrigin)\n          index += d.insert.length\n        } else if (d.delete) {\n          if (index < anchor) {\n            anchor = math.max(anchor - d.delete, index)\n          }\n          if (index < head) {\n            head = math.max(head - d.delete, index)\n          }\n          const start = cmDoc.posFromIndex(index)\n          const end = cmDoc.posFromIndex(index + d.delete)\n          cmDoc.replaceRange('', start, end, cmOrigin)\n        }\n      }\n    }\n    // if possible, bundle the changes using cm.operation\n    if (cm) {\n      cm.operation(performChange)\n    } else {\n      performChange()\n    }\n    if (switchSel) {\n      const tmp = head\n      head = anchor\n      anchor = tmp\n    }\n    cm.setSelection(cm.posFromIndex(anchor), cm.posFromIndex(head))\n  })\n}\n\nconst targetObserver = (binding, changes) => {\n  binding._mux(() => {\n    binding.doc.transact(() => {\n      if (changes.length > 1) {\n        // If there are several consecutive changes, we can't reliably compute the positions anymore. See y-codemirror#11\n        // Instead, we will compute the diff and apply the changes\n        const d = diff.simpleDiffString(binding.type.toString(), binding.cmDoc.getValue())\n        binding.type.delete(d.index, d.remove)\n        binding.type.insert(d.index, d.insert)\n      } else {\n        const change = changes[0]\n        const start = binding.cmDoc.indexFromPos(change.from)\n        const delLen = change.removed.map(s => s.length).reduce(math.add) + change.removed.length - 1\n        if (delLen > 0) {\n          binding.type.delete(start, delLen)\n        }\n        if (change.text.length > 0) {\n          binding.type.insert(start, change.text.join('\\n'))\n        }\n      }\n    }, binding)\n  })\n}\n\nconst createRemoteCaret = (username, color) => {\n  const caret = document.createElement('span')\n  caret.classList.add('remote-caret')\n  caret.setAttribute('style', `border-color: ${color}`)\n  const userDiv = document.createElement('div')\n  userDiv.setAttribute('style', `background-color: ${color}`)\n  userDiv.insertBefore(document.createTextNode(username), null)\n  caret.insertBefore(userDiv, null)\n  setTimeout(() => {\n    caret.classList.add('hide-name')\n  }, 2000)\n  return caret\n}\n\nconst createEmptyLinePlaceholder = (color) => {\n  const el = document.createElement('span')\n  el.setAttribute('class', 'y-line-selection')\n  el.setAttribute('style', `display: inline-block; position: absolute; left: 4px; right: 4px; top: 0; bottom: 0; background-color: ${color}70`)\n  return el\n}\n\nconst updateRemoteSelection = (y, cm, type, cursors, clientId, awareness) => {\n  // redraw caret and selection for clientId\n  const aw = awareness.getStates().get(clientId)\n  // destroy current text mark\n  const m = cursors.get(clientId)\n  if (m !== undefined) {\n    if (m.caret) {\n      m.caret.clear()\n    }\n    m.sel.forEach(sel => sel.clear())\n    cursors.delete(clientId)\n  }\n  if (aw === undefined) {\n    return\n  }\n  const user = aw.user || {}\n  if (user.color == null) {\n    user.color = '#ffa500'\n  }\n  if (user.name == null) {\n    user.name = `User: ${clientId}`\n  }\n  const cursor = aw.cursor\n  if (cursor == null || cursor.anchor == null || cursor.head == null) {\n    return\n  }\n  const anchor = Y.createAbsolutePositionFromRelativePosition(JSON.parse(cursor.anchor), y)\n  const head = Y.createAbsolutePositionFromRelativePosition(JSON.parse(cursor.head), y)\n  if (anchor !== null && head !== null && anchor.type === type && head.type === type) {\n    const headpos = cm.posFromIndex(head.index)\n    const anchorpos = cm.posFromIndex(anchor.index)\n    let from, to\n    if (head.index < anchor.index) {\n      from = headpos\n      to = anchorpos\n    } else {\n      from = anchorpos\n      to = headpos\n    }\n    const caretEl = createRemoteCaret(user.name, user.color)\n    // if position was \"relatively\" the same, do not show name again and hide instead\n    if (m && func.equalityFlat(aw.cursor.anchor, m.awCursor.anchor) && func.equalityFlat(aw.cursor.head, m.awCursor.head)) {\n      caretEl.classList.add('hide-name')\n    }\n    const sel = []\n\n    if (head.index !== anchor.index) {\n      if (from.line !== to.line && from.ch !== 0) {\n        // start of selection will only be a simple text-selection\n        sel.push(cm.markText(from, new CodeMirror.Pos(from.line + 1, 0), { css: `background-color: ${user.color}70;`, inclusiveRight: false, inclusiveLeft: false }))\n        from = new CodeMirror.Pos(from.line + 1, 0)\n      }\n      while (from.line !== to.line) {\n        // middle of selection is always a whole-line selection. We add a widget at the first position which will fill the background.\n        sel.push(cm.setBookmark(new CodeMirror.Pos(from.line, 0), { widget: createEmptyLinePlaceholder(user.color) }))\n        from = new CodeMirror.Pos(from.line + 1, 0)\n      }\n      sel.push(cm.markText(from, to, { css: `background-color: ${user.color}70;`, inclusiveRight: false, inclusiveLeft: false }))\n    }\n    // only render caret if not the complete last line was selected (in this case headpos.ch === 0)\n    const caret = sel.length > 0 && to === headpos && headpos.ch === 0 ? null : cm.setBookmark(headpos, { widget: caretEl, insertLeft: true })\n    cursors.set(clientId, { caret, sel, awCursor: cursor })\n  }\n}\n\nconst codemirrorCursorActivity = (y, cm, type, awareness) => {\n  const aw = awareness.getLocalState()\n  if (!cm.hasFocus() || aw == null || !cm.display.wrapper.ownerDocument.hasFocus()) {\n    return\n  }\n  const newAnchor = Y.createRelativePositionFromTypeIndex(type, cm.indexFromPos(cm.getCursor('anchor')))\n  const newHead = Y.createRelativePositionFromTypeIndex(type, cm.indexFromPos(cm.getCursor('head')))\n  let currentAnchor = null\n  let currentHead = null\n  if (aw.cursor != null) {\n    currentAnchor = Y.createRelativePositionFromJSON(JSON.parse(aw.cursor.anchor))\n    currentHead = Y.createRelativePositionFromJSON(JSON.parse(aw.cursor.head))\n  }\n  if (aw.cursor == null || !Y.compareRelativePositions(currentAnchor, newAnchor) || !Y.compareRelativePositions(currentHead, newHead)) {\n    awareness.setLocalStateField('cursor', {\n      anchor: JSON.stringify(newAnchor),\n      head: JSON.stringify(newHead)\n    })\n  }\n}\n\n/**\n * A binding that binds a YText to a CodeMirror editor.\n *\n * @example\n *   const ytext = ydocument.define('codemirror', Y.Text)\n *   const editor = new CodeMirror(document.querySelector('#container'), {\n *     mode: 'javascript',\n *     lineNumbers: true\n *   })\n *   const binding = new CodemirrorBinding(ytext, editor)\n *\n */\nexport class CodemirrorBinding {\n  /**\n   * @param {Y.Text} textType\n   * @param {import('codemirror').Editor} codeMirror\n   * @param {any} [awareness]\n   */\n  constructor (textType, codeMirror, awareness) {\n    const doc = textType.doc\n    const cmDoc = codeMirror.getDoc()\n    this.doc = doc\n    this.type = textType\n    this.cm = codeMirror\n    this.cmDoc = cmDoc\n    this.awareness = awareness\n    // this.undoManager = new Y.UndoManager(textType, { trackedOrigins: new Set([this]) })\n    this._mux = createMutex()\n    // set initial value\n    cmDoc.setValue(textType.toString())\n    // observe type and target\n    this._typeObserver = event => typeObserver(this, event)\n    this._targetObserver = (instance, changes) => {\n      if (instance.getDoc() === cmDoc) {\n        targetObserver(this, changes)\n      }\n    }\n    this._cursors = new Map()\n    this._changedCursors = new Set()\n    this._debounceCursorEvent = eventloop.createDebouncer(10)\n    this._awarenessListener = event => {\n      if (codeMirror.getDoc() !== cmDoc) {\n        return\n      }\n      const f = clientId => {\n        if (clientId !== doc.clientID) {\n          this._changedCursors.add(clientId)\n        }\n      }\n      event.added.forEach(f)\n      event.removed.forEach(f)\n      event.updated.forEach(f)\n      if (this._changedCursors.size > 0) {\n        this._debounceCursorEvent(() => {\n          this._changedCursors.forEach(clientId => {\n            updateRemoteSelection(doc, codeMirror, textType, this._cursors, clientId, awareness)\n          })\n          this._changedCursors.clear()\n        })\n      }\n    }\n    this._cursorListener = () => {\n      if (codeMirror.getDoc() === cmDoc) {\n        setTimeout(() => {\n          codemirrorCursorActivity(doc, codeMirror, textType, awareness)\n        }, 0)\n      }\n    }\n    this._blurListeer = () => awareness.setLocalStateField('cursor', null)\n\n    textType.observe(this._typeObserver)\n    // @ts-ignore\n    codeMirror.on('changes', this._targetObserver)\n    if (awareness) {\n      codeMirror.on('swapDoc', this._blurListeer)\n      awareness.on('change', this._awarenessListener)\n      // @ts-ignore\n      codeMirror.on('cursorActivity', this._cursorListener)\n      codeMirror.on('blur', this._blurListeer)\n      codeMirror.on('focus', this._cursorListener)\n    }\n  }\n\n  destroy () {\n    this.type.unobserve(this._typeObserver)\n    this.cm.off('swapDoc', this._blurListeer)\n    // @ts-ignore\n    this.cm.off('changes', this._targetObserver)\n    // @ts-ignore\n    this.cm.off('cursorActivity', this._cursorListener)\n    this.cm.off('focus', this._cursorListener)\n    this.cm.off('blur', this._blurListeer)\n    if (this.awareness) {\n      this.awareness.off('change', this._awarenessListener)\n    }\n    this.type = null\n    this.cm = null\n    this.cmDoc = null\n    // this.undoManager.destroy()\n  }\n}\n\nexport const CodeMirrorBinding = CodemirrorBinding\n"],"names":["math.max","diff.simpleDiffString","math.add","Y.createAbsolutePositionFromRelativePosition","func.equalityFlat","CodeMirror","Y.createRelativePositionFromTypeIndex","Y.createRelativePositionFromJSON","Y.compareRelativePositions","createMutex","eventloop.createDebouncer"],"mappings":"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"}